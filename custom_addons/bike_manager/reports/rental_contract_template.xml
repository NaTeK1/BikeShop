<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_rental_contract_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">

                        <t t-set="pricing_label" t-value="{'hourly':'Horaire','daily':'Journalier','weekly':'Hebdomadaire','monthly':'Mensuel'}.get(o.pricing_type, o.pricing_type)"/>
                        <t t-set="pricing_unit" t-value="{'hourly':'heure','daily':'jour','weekly':'semaine','monthly':'mois'}.get(o.pricing_type, '')"/>
                        <t t-set="payment_label" t-value="{'cash':'Espèces','card':'Carte','transfer':'Virement bancaire'}.get(o.payment_method, 'Non précisé')"/>

                        <!-- En-tête -->
                        <div class="text-center mb-4">
                            <h1>CONTRAT DE LOCATION DE VÉLO</h1>
                            <h3 class="text-muted"><t t-esc="o.name"/></h3>
                        </div>

                        <!-- Informations contrat -->
                        <div class="row mt-4 mb-4">
                            <div class="col-6">
                                <h4>Informations client</h4>
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Nom :</strong></td>
                                        <td><t t-esc="o.customer_id.name"/></td>
                                    </tr>
                                    <tr t-if="o.customer_id.email">
                                        <td><strong>E-mail :</strong></td>
                                        <td><t t-esc="o.customer_id.email"/></td>
                                    </tr>
                                    <tr t-if="o.customer_id.phone">
                                        <td><strong>Téléphone :</strong></td>
                                        <td><t t-esc="o.customer_id.phone"/></td>
                                    </tr>
                                    <tr t-if="o.customer_id.street">
                                        <td><strong>Adresse :</strong></td>
                                        <td>
                                            <t t-esc="o.customer_id.street"/><br/>
                                            <span t-if="o.customer_id.city"><t t-esc="o.customer_id.zip"/> <t t-esc="o.customer_id.city"/></span>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-6">
                                <h4>Informations location</h4>
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Contrat n° :</strong></td>
                                        <td><t t-esc="o.name"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Statut :</strong></td>
                                        <td>
                                            <span t-if="o.state == 'draft'" class="badge badge-secondary">Brouillon</span>
                                            <span t-if="o.state == 'ongoing'" class="badge badge-warning">En cours</span>
                                            <span t-if="o.state == 'returned'" class="badge badge-success">Retournée</span>
                                            <span t-if="o.state == 'cancelled'" class="badge badge-danger">Annulée</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Type de tarification :</strong></td>
                                        <td><t t-esc="pricing_label"/></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Vélo loué -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Vélo loué</h4>
                                <table class="table table-bordered">
                                    <thead style="background-color: #f8f9fa;">
                                        <tr>
                                            <th>Produit</th>
                                            <th>Référence</th>
                                            <th>Catégorie</th>
                                            <th class="text-right">Prix unitaire</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong><t t-esc="o.product_id.name"/></strong></td>
                                            <td><t t-esc="o.product_id.reference"/></td>
                                            <td><t t-esc="o.product_id.category_id.name"/></td>
                                            <td class="text-right"><t t-esc="'%.2f' % o.unit_price"/> €</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Période -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Période de location</h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td width="25%"><strong>Date de début :</strong></td>
                                        <td width="25%"><t t-esc="o.start_date.strftime('%Y-%m-%d %H:%M')"/></td>
                                        <td width="25%"><strong>Date de fin :</strong></td>
                                        <td width="25%"><t t-esc="o.end_date.strftime('%Y-%m-%d %H:%M')"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Durée :</strong></td>
                                        <td><t t-esc="'%.2f' % o.duration"/> <t t-esc="pricing_unit"/>(s)</td>
                                        <td t-if="o.actual_return_date"><strong>Retour réel :</strong></td>
                                        <td t-if="o.actual_return_date"><t t-esc="o.actual_return_date.strftime('%Y-%m-%d %H:%M')"/></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Détails prix -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Détails de facturation</h4>
                                <table class="table table-bordered">
                                    <tr>
                                        <td width="75%"><strong>Prix de location (<t t-esc="'%.2f' % o.duration"/> <t t-esc="pricing_unit"/>(s) × <t t-esc="'%.2f' % o.unit_price"/> €)</strong></td>
                                        <td width="25%" class="text-right"><t t-esc="'%.2f' % o.total_price"/> €</td>
                                    </tr>
                                    <tr t-if="o.deposit_amount > 0">
                                        <td><strong>Montant de la caution</strong></td>
                                        <td class="text-right"><t t-esc="'%.2f' % o.deposit_amount"/> €</td>
                                    </tr>
                                    <tr t-if="o.additional_charges > 0" style="background-color: #fff3cd;">
                                        <td><strong>Frais supplémentaires (retard, dommages, etc.)</strong></td>
                                        <td class="text-right"><t t-esc="'%.2f' % o.additional_charges"/> €</td>
                                    </tr>
                                    <tr style="background-color: #d4edda; font-size: 1.2em;">
                                        <td><strong>MONTANT TOTAL</strong></td>
                                        <td class="text-right"><strong><t t-esc="'%.2f' % o.total_amount"/> €</strong></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Mode de paiement :</strong></td>
                                        <td class="text-right"><t t-esc="payment_label"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Statut du paiement :</strong></td>
                                        <td class="text-right">
                                            <span t-if="o.is_paid" class="badge badge-success">Payée</span>
                                            <span t-else="" class="badge badge-warning">Non payée</span>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- État du vélo -->
                        <div class="row mb-4" t-if="o.condition_on_pickup or o.condition_on_return">
                            <div class="col-12">
                                <h4>État du vélo</h4>
                                <table class="table table-bordered">
                                    <tr t-if="o.condition_on_pickup">
                                        <td width="25%"><strong>État au retrait :</strong></td>
                                        <td width="75%"><t t-esc="o.condition_on_pickup"/></td>
                                    </tr>
                                    <tr t-if="o.condition_on_return">
                                        <td><strong>État au retour :</strong></td>
                                        <td><t t-esc="o.condition_on_return"/></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="row mb-4" t-if="o.notes">
                            <div class="col-12">
                                <h4>Notes</h4>
                                <p><t t-esc="o.notes"/></p>
                            </div>
                        </div>

                        <!-- Signatures -->
                        <div class="row mt-5">
                            <div class="col-6">
                                <p class="mb-0"><strong>Signature du client :</strong></p>
                                <div style="border-bottom: 1px solid black; width: 200px; height: 50px; margin-top: 10px;"></div>
                                <p class="mt-2"><small>Date : _________________</small></p>
                            </div>
                            <div class="col-6">
                                <p class="mb-0"><strong>Représentant du magasin :</strong></p>
                                <div style="border-bottom: 1px solid black; width: 200px; height: 50px; margin-top: 10px;"></div>
                                <p class="mt-2"><small>Date : _________________</small></p>
                            </div>
                        </div>

                        <!-- Pied de page -->
                        <div class="row mt-5">
                            <div class="col-12 text-center text-muted">
                                <small>
                                    Document généré le <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                </small>
                            </div>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
